---
title: "Projeto da Pós Graduação, disciplina Estatística para Cientista de Dados."
author: "Antonio Vieira dos Santos Neto - Cpf 077.523.948-82"
date: "2023-03-10"
output:
  bookdown::pdf_document2:
    latex_engine: lualatex
  tufte::tufte_handout:
    latex_engine: xelatex
---

```{r setup, include=FALSE}
knitr::opts_chunk $ set(echo = TRUE)
```

## Introdução

O presente projeto visa demonstrar os conhecimentos nos fundamentos básicos na utilização da linguagem "R", bem como, nos conhecimentos de Estatística.

Neste documento, segue o passo a passo, onde são demonstrados os conhecimentos adquiridos na disciplina.

## Objetivo do Projeto

Demonstrar os conhecimentos adquiridos na disciplina "Estatística para Cientista de Dados", sendo que , através do uso da Linguagem "R", serão feitas diversas análises em uma "Base de evolução de registro de ocorrências do Instituto de Segurança Pública do Rio de Janeiro".

## Preparando o ambiente de análise

Para a criação do ambiente de trabalho foram adotados os seguinte passos :

1-Instalação da linguagem "R" na máquina do aluno. 2-Instalação do Studio "R" na máquina do aluno. 3-Instalação do "GIT" na máquina do aluno. Esta aplicação permite o controle dos versionamentos dos aplicações desenvolvidas. 4-Configuração na nuvem do "GITHUB, criando um repositório"WORK", para arquivo das aplicações desenvolvidas, bem como, controle do versionamento destas.

-   Atenção:
-   1 - As evidências da configuração do ambiente, segue no documento "PROJETO_ESTATISTICA.PDF"
-   2 - O caminho para o Github do aluno e´: <https://github.com/avsneto2/work.git>
-   3- Os arquivos do projeto se encontram na branch : Projeto_Estatistica_1

#### Importando bilbiotecas necessárias ao desenvolvimento.

Para suporte no tratamento da base de dados, foram instaladas as bibliotecas a seguir a partir do comando "install.packages".

-   install.packages("tidyverse") - Pacote de ferramentas que tem por objetivo manipulação, exploração e visualização de dados.

-   install.packages("data.table") - Pacote que também tem a função de manipular dados, porém, em algumas situações, permite o tratamento de dados com maior velocidade

-   install.packages("rvest") - Uma das funções do Pacote "rvest" e permitir a leitura de dados a partir de código html, dessa forma o "R" poderá mapear e navegar pela arvore do html.

-   install.packages("robotstxt") - Este pacote fornece funcoes para baixar e analisar arquivos 'robots.txt'.

-   install.packages("knitr") - Este pacote tem a funcao de gerar relatorios dinamicos com R.

-   instal.packages ("dlookr") - Este pacote informações estatísticas sobre dados como visualização, valores ausentes, discrepantes e valores exclusivos e negativos, com o objetivo de entender a distribuição e qualidade dos dados.

-   instal.packages ("readxl") - Este pacote permite a leitura de arquivos excel.

-   instal.packages ("summarytools") - Este pacote permite a análise de dados, como a frequencia de uma determinada variavel;

-   instal.packages ("ggplot2") - Este pacote permite o desenvolvimento de graficos;

-   instal.packages ("fitdistrplus") - \*\* Atencao

```{r importando bibliotecas, echo=TRUE}
library(tidyverse)
library(rvest)
library(data.table)
library(robotstxt)
library(knitr)
library(dlookr)
library(readxl)
library(summarytools)
library(ggplot2)
library(fitdistrplus)
library(readr)

```

#### Definindo o diretório de trabalho para o projeto

Posteriomente, vamos trocar o diretório de referência para o trabalho, mas não vamos deixar essa informação pública para o usuário.

```{r mudando o diretório, echo=FALSE}
setwd("E:/DADOS/VIEIRA/POS GRADUACAO/INFINET/CURSO/WORK_Trabalho/work")
getwd()
```

#### Importando dados

A partir da definição do ambiente, o arquivo "BaseDPEvolucaoMensalCisp.csv", contendo a base de evolução de registro de ocorrencias do Instituto de Segurança Publica do Rio de Janeiro, será importado utilizando a biblioteca rvest, para ler o arquivo "CSV.

```{r importando os dados, echo=TRUE}
## Bevolucao.tbl <- readr::read_csv2("BaseDPEvolucaoMensalCisp.csv")
Bevolucao.tbl <- readr::read_csv2("BaseDPEvolucaoMensalCisp.csv", locale=locale(encoding="latin1"))

kable(head(Bevolucao.tbl))
```

#### Selecionando dados

Uma vez que os dados foram importados, faremos a seleção das colunas importantes para a análise. Dessa forma, serão selecionados os dados referentes as ocorrencias relacionadas ao evento de apreensão de drogas versus roubos.

```{r selecionando variáveis, echo = TRUE}

Bevolucao.roubos.tbl <- Bevolucao.tbl %>% dplyr::select(CISP,ano,mes_ano,munic,Regiao,apreensao_drogas, roubo_transeunte,roubo_celular,roubo_residencia, roubo_rua)
kable(head(Bevolucao.roubos.tbl))
```

#### Selecionando os movimentos referentes aos três últimos anos

Com base na coluna ano, selecionar o movimento dos três últimos anos.

```{r selecionando dados por ano, echo=TRUE}
Bevolucao.roubos.f1.tbl=Bevolucao.roubos.tbl %>% dplyr::filter (ano =='2022'| ano =='2021' | ano =='2020')
kable(head(Bevolucao.roubos.f1.tbl))
```

#### Agrupando por regiao, munic, ano e mes/ano.

Vamos agrupar os dados por regiao, municipio e ano,com o objetivo de entender o movimento das ocorrencias de roubo no periodo.

```{r agrupando dados por regiao, munic, ano, echo=TRUE}
Bevolucao.roubos.f2.tbl <- Bevolucao.roubos.f1.tbl %>% dplyr::group_by(Regiao, munic, ano, mes_ano) %>% dplyr::summarise(roubo_transeunte_sum = sum(roubo_transeunte), apreensao_drogas_sum = sum(apreensao_drogas),roubo_celular_sum = sum(roubo_celular),roubo_residencia_sum = sum(roubo_residencia),roubo_rua_sum =sum(roubo_rua))
kable(head(Bevolucao.roubos.f2.tbl))
```

#### Convertendo dados da coluna "mes_ano" e retirando caracter com acento.

Os dados da coluna "mes_ano" encontram-se no formato "aaaammm" e deverão ser convertidos para o formato "aaaa-mm".

```{r convertendo dados pop, echo=TRUE}

Bevolucao.roubos.f3.tbl <-Bevolucao.roubos.f2.tbl %>% dplyr::mutate(mes_ano = stringr::str_replace_all(mes_ano, "\\m", "-"))

kable(head(Bevolucao.roubos.f3.tbl))
```

## Iniciando a analise dos dados

#### Identificando os tipos de variaveis

Para identificar os tipos de cada variável na base, vamos utilizar o pacote "dlookr".

```{r identificando os tipos de variáveis, echo = TRUE}
Bevolucao.roubos.f3.tbl%>% dlookr::diagnose()
```

Na tabela "Bevolucao.roubos.f3.tbl" é possivel identificar as variaveis do tipo QUALITATIVAS NOMINAIS que são:

-   Regiao = Regiao
-   munic = Municipio
-   ano = ano relacionado ao registro das ocorrencias.
-   mes_ano= mes e ano relacionado ao registro das ocorrencias

Na tabela "Bevolucao.roubos.f4.tbl" e possivel identificar as variaveis do tipo QUANTITATIVAS DISCRETAS que são:

-   roubo_transeunte_sum
-   apreensao_drogas_sum

#### Identicando a frequencia de variaveis

Para o próximo passo irei analiser a frequencia das variaveis.

Dessa forma a base foi sumarizada pelas variaveis "Ano(ano)", "Regiao(Regiao)" e "Municipio(munic)", sendo que, para cada ano, foi verificada a frequencia da variavel "Regiao".

```{r agrupa por ano/Regiao/munic, echo = TRUE}

Bevolucao.roubos.f4.tbl <- Bevolucao.roubos.f3.tbl %>% dplyr::group_by(ano, Regiao, munic) %>% dplyr::select(Regiao,ano,roubo_transeunte_sum, apreensao_drogas_sum,roubo_celular_sum,roubo_residencia_sum,roubo_rua_sum) %>% dplyr::summarise(roubo_transeunte_sum = sum(roubo_transeunte_sum), apreensao_drogas_sum = sum(apreensao_drogas_sum),roubo_celular_sum = sum(roubo_celular_sum),roubo_residencia_sum = sum(roubo_residencia_sum),roubo_rua_sum = sum(roubo_rua_sum))
kable(head(Bevolucao.roubos.f4.tbl))
```

-   Frequencia da variavel : Regiao

O que se observa com base na analise de frequencia, é que a maior ocorrencia dos eventos de roubos e apreensao de drogas, em termos de quantidade de municipios, se da na REGIAO DO INTERIOR DO RIO DE JANEIRO, com 79.27% (65 ocorrencias).

```{r frequência variavel Regiao, echo = TRUE}
Bevolucao.roubos.f4.tbl %>% dplyr::group_by(ano) %>% dplyr::select(Regiao) %>% summarytools::freq()
```

#### Fazendo analise descritiva e de histogramas de uma variavel quantitativa discreta

Com base nas variaveis qualitativas (Ano e Regiao), foi feita uma análise considerando a centralidade dos dados para a variavel roubo_transeunte_sum e apreensao_drogas_sum, através da funcao descr do pacote summarytools (descr).

-Variavel roubo_transeunte_sum : A conclusão é que na maioria das regiões existe uma divergência considerável entre os valores de média (Mean) e mediana (Median), o que sugere a presença de outliers.

```{r desc variavel roubo_transeunte_sum3 , echo = TRUE}
Bevolucao.roubos.f4.tbl %>% dplyr::group_by(ano,Regiao) %>% dplyr::select(roubo_transeunte_sum) %>% summarytools::descr()
```

-Variavel apreensao_drogas_sum : De forma análoga, à variável anterior, observa-se várias divergências na analise dos valores de média e mediana da variavel apreensao_drogas_sum, também sugerindo a presença de outliers.

```{r desc variavel apreensao_drogas_sum , echo = TRUE}
Bevolucao.roubos.f4.tbl %>% dplyr::group_by(ano,Regiao) %>% dplyr::select(apreensao_drogas_sum) %>% summarytools::descr()
```

#### Análise visual da variável

Será realizada através da binarização dos dados. Para a analise, será considerada uma amostra do ano de 2022 e ocorrencias da Região interior, onde verificou-se a maior frequencia de cidades, com casos de roubo e apreensao de drogas.

Dado que não tenho conhecimento da binarização ideal, será considerado o intervalo interquatil, centralidade dos dados, dispersão, assimetria, para verificar a presença de outliers. Farei uso do pacote summarytools e funcao descr.

```{r agrupando por ano,Regiao , echo = TRUE}
Bevolucao.roubos.f5.tbl <- Bevolucao.roubos.f4.tbl %>% dplyr::group_by(Regiao,ano,munic) %>% dplyr::filter (ano =='2022'& Regiao=="Interior") %>%  dplyr::select(ano, Regiao,munic, roubo_transeunte_sum, apreensao_drogas_sum,roubo_celular_sum, roubo_residencia_sum, roubo_rua_sum) %>% dplyr::summarise(roubo_transeunte_sum = sum(roubo_transeunte_sum), apreensao_drogas_sum = sum(apreensao_drogas_sum),roubo_celular_sum = sum(roubo_celular_sum),roubo_residencia_sum = sum(roubo_residencia_sum),roubo_rua_sum = sum(roubo_rua_sum))
kable(head(Bevolucao.roubos.f5.tbl))

```

```{r desc variavel roubo_transeunte_sum2 , echo = TRUE}
Bevolucao.roubos.f5.tbl %>% dplyr::select(roubo_transeunte_sum) %>% summarytools::descr()
```

Apos a execução do da funcao descr, verifica-se que existe uma divergência considerável entre o valor da média e mediana. Também observa-se que o Skewness, possui um valor de assimetria superior a 1 (Skewness = 3.09), o que concluí-se que trata-se de um caso de ALTA ASSIMETRIA, COM PRESENÇA DE OUTLIERS.

Para definição do intervalo interquartil, vou considerar :

-   intervalo interquatil buscando uma relacao entre a concentração dos dados;
-   Considerando a presença de outliers, farei uso da regra de Freedman-Diaconis
-   Também farei uma análise considerando a estimativa por kernel.

```{r analisando crimes visualmente , echo = TRUE}
Bevolucao.roubos.f5.tbl %>% dplyr::select(roubo_transeunte_sum) %>% ggplot(aes(x=roubo_transeunte_sum))+geom_histogram(aes(y = after_stat(density)) ,bins = 30, fill = 'lightblue') + xlab('roubo_transeunte_sum') + ylab('Densidade de Frequência') + geom_vline(xintercept=c(median(Bevolucao.roubos.f5.tbl$roubo_transeunte_sum), mean(Bevolucao.roubos.f5.tbl$roubo_transeunte_sum))) + annotate("text", x=median(Bevolucao.roubos.f5.tbl$roubo_transeunte_sum) + 0.3, y=0.05, label="Mediana", angle=90) + annotate("text", x=mean(Bevolucao.roubos.f5.tbl$roubo_transeunte_sum) + 0.3, y=0.05, label="Média", angle=90) + theme_classic()
```

No Caso em questão, observação uma concentração de dados a esquerda, com calda a direita, reforçando o cenário de assimetria entre os dados.

```{r analisando crimes visualmente com kernel , echo = TRUE}
Bevolucao.roubos.f5.tbl %>% dplyr::select(roubo_transeunte_sum) %>% ggplot(aes(x=roubo_transeunte_sum))+geom_histogram(aes(y = after_stat(density)) ,bins = 30, fill = 'lightblue') + xlab('roubo_transeunte_sum') + ylab('Densidade de Frequência') + labs(title = "Distribuição dos dados de crimes aproximada por Histograma", subtitle = "Binarização sugerida pelos detentores dos Dados") + geom_vline(xintercept=c(median(Bevolucao.roubos.f5.tbl$roubo_transeunte_sum), mean(Bevolucao.roubos.f5.tbl$roubo_transeunte_sum))) + annotate("text", x=median(Bevolucao.roubos.f5.tbl$roubo_transeunte_sum) + 0.3, y=0.05, label="Mediana", angle=90) + annotate("text", x=mean(Bevolucao.roubos.f5.tbl$roubo_transeunte_sum) + 0.3, y=0.05, label="Média", angle=90) + geom_density(linetype = 2) + theme_classic()
```

Neste caso, a amplitude da binarização foi ajustada para acompanhar a curva de pontos dos dados, onde cheguei a conclusçao que a amplitude ideal para a binarização é considerar o valor de 30.

Poderíamos também considerar outras regra de binarização levando em consideração regras disponíveis na literatura, como a regra de Freedman-Diaconis, bem como a regra de Sturge, como segue:

```{r definindo as funcoes geradoras de binwidths FD e S , echo = TRUE}

fd <- function(x) {
  n <-length(x)
  return((2*IQR(x))/n^(1/3))
}


sr <- function(x) {
  n <-length(x)
  return((3.49*sd(x))/n^(1/3))
}

```

```{r analisando salario visualmente com kernel e bin FD , echo = TRUE}
Bevolucao.roubos.f5.tbl %>% dplyr::select(roubo_transeunte_sum) %>% ggplot(aes(x=roubo_transeunte_sum))+geom_histogram(aes(y = after_stat(density)) , binwidth=fd, fill = 'lightblue') + xlab('roubo_transeunte_sum') + ylab('Densidade de Frequência') + labs(title = "Distribuição dos dados de crimes aproximada por Histograma", subtitle = "Binarização pela Regra de FD") + geom_vline(xintercept=c(median(Bevolucao.roubos.f5.tbl$roubo_transeunte_sum), mean(Bevolucao.roubos.f5.tbl$roubo_transeunte_sum))) + annotate("text", x=median(Bevolucao.roubos.f5.tbl$roubo_transeunte_sum) + 0.3, y=0.05, label="Mediana", angle=90) + annotate("text", x=mean(Bevolucao.roubos.f5.tbl$roubo_transeunte_sum) + 0.3, y=0.05, label="Média", angle=90) + geom_density(linetype = 2) + theme_classic()
```

```{r analisando salario visualmente com kernel e bin SR , echo = TRUE}
Bevolucao.roubos.f5.tbl %>% dplyr::select(roubo_transeunte_sum) %>% ggplot(aes(x=roubo_transeunte_sum))+geom_histogram(aes(y = after_stat(density)) , binwidth=sr, fill = 'lightblue') + xlab('roubo_transeunte_sum') + ylab('Densidade de Frequência') + labs(title = "Distribuição dos dados de crimes aproximada por Histograma", subtitle = "Binarização pela Regra de Sturge") + geom_vline(xintercept=c(median(Bevolucao.roubos.f5.tbl$roubo_transeunte_sum), mean(Bevolucao.roubos.f5.tbl$roubo_transeunte_sum))) + annotate("text", x=median(Bevolucao.roubos.f5.tbl$roubo_transeunte_sum) + 0.3, y=0.05, label="Mediana", angle=90) + annotate("text", x=mean(Bevolucao.roubos.f5.tbl$roubo_transeunte_sum) + 0.3, y=0.05, label="Média", angle=90) + geom_density(linetype = 2) + theme_classic()
```

-   CONCLUSÃO :

Para as características da base analisada, com uma assimetria acentuada, a regra de FD (Freedman Diaconis), se demonstra mais adequada para a análise.

#### Analise inter variáveis

Neste caso farei o filtro para selecionando as localidades que tenham valores para apreensão de drogas (apreensao_drogas_sum) que deverá ser comparado com outras 4 variaveis da base.

##```{r Correlacao de variaveis , echo = TRUE}
## kable(cor(Bevolucao.roubos.f5.tbl %>% dplyr::filter(!is.na(apreensao_drogas_sum)) %>% ## dplyr::select(apreensao_drogas_sum, ## roubo_transeunte_sum,roubo_celular_sum,roubo_residencia_sum))) 
## ```

-   Scatterplot apreensao_drogas_sum x roubo_transeunte_sum

```{r analisando scatter entre variaveis mais correlacionadas3 , echo = TRUE}
Bevolucao.roubos.f5.tbl %>% dplyr::filter(!is.na(apreensao_drogas_sum)) %>% dplyr::select(apreensao_drogas_sum, roubo_transeunte_sum,roubo_celular_sum,roubo_residencia_sum) %>% ggplot(aes(x=apreensao_drogas_sum, y =roubo_transeunte_sum)) + geom_point() + geom_smooth(method = "lm", se = FALSE) + theme_classic()
```

-   Scatterplot apreensao_drogas_sum x roubo_celular_sum

```{r analisando scatter entre variaveis mais correlacionadas , echo = TRUE}
Bevolucao.roubos.f5.tbl %>% dplyr::filter(!is.na(apreensao_drogas_sum)) %>% dplyr::select(apreensao_drogas_sum, roubo_transeunte_sum,roubo_celular_sum,roubo_residencia_sum) %>% ggplot(aes(x=apreensao_drogas_sum, y =roubo_celular_sum)) + geom_point() + geom_smooth(method = "lm", se = FALSE) + theme_classic()
```

-   Scatterplot apreensao_drogas_sum x roubo_residencia_sum

```{r analisando scatter entre variaveis mais correlacionadas2 , echo = TRUE}
Bevolucao.roubos.f5.tbl %>% dplyr::filter(!is.na(apreensao_drogas_sum)) %>% dplyr::select(apreensao_drogas_sum, roubo_transeunte_sum,roubo_celular_sum,roubo_residencia_sum) %>% ggplot(aes(x=apreensao_drogas_sum, y =roubo_residencia_sum)) + geom_point() + geom_smooth(method = "lm", se = FALSE) + theme_classic()
```

-   Criando um grafico de barras, utilizando 2 variaveis

```{r grafico de barras, echo = TRUE}
ggplot(Bevolucao.roubos.f5.tbl %>% dplyr::filter(munic =="Angra dos Reis"|munic == "Araruama"| munic=="Cabo Frio" |munic=="Cambuci") %>% dplyr::select(munic, roubo_rua_sum), aes(x = munic, y =roubo_rua_sum)) + geom_bar(stat = "identity")
```
